# script créé le : Fri Sep 21 14:26:54 CEST 2012 -   syntaxe MySQL ;

# use  VOTRE_BASE_DE_DONNEE ;

DROP TABLE IF EXISTS SOURCE_FAV ;
DROP TABLE IF EXISTS ARTICLE_FAV ;
DROP TABLE IF EXISTS ARTICLE ;
DROP TABLE IF EXISTS SOURCE ;
DROP TABLE IF EXISTS CATEGORIE_FAV ;
DROP TABLE IF EXISTS CATEGORIE ;
DROP TABLE IF EXISTS USER ;


CREATE TABLE USER (login CHAR(16) NOT NULL,
password CHAR(32),
derniere_connexion CHAR(12),
PRIMARY KEY (login) ) ENGINE=InnoDB;


CREATE TABLE CATEGORIE (id_cat int AUTO_INCREMENT NOT NULL,
libelle CHAR(50),
description CHAR(100),
date_maj CHAR(12),
image CHAR(50),
PRIMARY KEY (id_cat) ) ENGINE=InnoDB;



CREATE TABLE CATEGORIE_FAV (id_cat int AUTO_INCREMENT NOT NULL,
login CHAR(16),
PRIMARY KEY (id_cat, login) ) ENGINE=InnoDB;
ALTER TABLE CATEGORIE_FAV ADD CONSTRAINT FK_Cat_Fav_idcat FOREIGN KEY (id_cat) REFERENCES CATEGORIE (id_cat);
ALTER TABLE CATEGORIE_FAV ADD CONSTRAINT FK_Cat_Fav_login FOREIGN KEY (login) REFERENCES USER (login);


CREATE TABLE SOURCE (id_source int AUTO_INCREMENT NOT NULL,
id_cat INT,
libelle INT,
lien INT,
PRIMARY KEY (id_source, id_cat) ) ENGINE=InnoDB;
ALTER TABLE SOURCE ADD CONSTRAINT FK_Source_idcat FOREIGN KEY (id_cat) REFERENCES CATEGORIE (id_cat);


CREATE TABLE ARTICLE (id_art int AUTO_INCREMENT NOT NULL,
id_source INT,
titre CHAR(100),
contenu TEXT,
date CHAR(12),
PRIMARY KEY (id_art) ) ENGINE=InnoDB;
ALTER TABLE ARTICLE ADD CONSTRAINT FK_ART_idsource FOREIGN KEY (id_source) REFERENCES SOURCE (id_source);



CREATE TABLE ARTICLE_FAV (login CHAR(16) NOT NULL,
id_art INT,
id_source INT,
titre CHAR(100),
contenu TEXT,
date CHAR(12),
id_cat INT,
PRIMARY KEY (login, id_art) ) ENGINE=InnoDB;
ALTER TABLE ARTICLE_FAV ADD CONSTRAINT FK_ART_Fav_idcat FOREIGN KEY (id_cat) REFERENCES CATEGORIE (id_cat);
ALTER TABLE ARTICLE_FAV ADD CONSTRAINT FK_ART_Fav_login FOREIGN KEY (login) REFERENCES USER (login);
ALTER TABLE ARTICLE_FAV ADD CONSTRAINT FK_ART_Fav_idart FOREIGN KEY (id_art) REFERENCES ARTICLE (id_art);
ALTER TABLE ARTICLE_FAV ADD CONSTRAINT FK_ART_Fav_idsrc FOREIGN KEY (id_source) REFERENCES SOURCE (id_source);




CREATE TABLE SOURCE_FAV (login CHAR NOT NULL,
id_source INT,
PRIMARY KEY (login, id_source) ) ENGINE=InnoDB;
ALTER TABLE ARTICLE_FAV ADD CONSTRAINT FK_src_Fav_login FOREIGN KEY (login) REFERENCES USER (login);
ALTER TABLE ARTICLE_FAV ADD CONSTRAINT FK_src_Fav_source FOREIGN KEY (id_source) REFERENCES SOURCE (id_source);
